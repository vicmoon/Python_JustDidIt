{# templates/tracking.html #} {% extends "base.html" %} {% block title %}Track ·
Just Did It{% endblock %} {% block content %} {% with messages =
get_flashed_messages(with_categories=true) %} {% if messages %}
<!-- <div class="error-messages">
  {% for category, message in messages %}
  <div class="alert alert-{{ category }}">{{ message }}</div>
  {% endfor %}
</div> -->

{% endif %} {% endwith %}
<div class="tracking-page">
  <div class="tracking-container">
    <div class="tracking-existing-activities">
      {% if activities %}
      <ul id="activityList" class="chosen-activity-list">
        {% for a in activities %}
        <li
          class="activity-pill"
          data-id="{{ a.id }}"
          data-icon="{{ a.icon_ref }}"
        >
          <button
            class="pill-delete"
            type="button"
            aria-label="Delete activity"
          >
            ×
          </button>
          <img
            src="https://api.iconify.design/{{ a.icon_ref|replace(':','/') }}.svg"
            width="20"
            height="20"
            loading="lazy"
          />
          <span>{{ a.name }}</span>
        </li>
        {% endfor %}
      </ul>
      <div class="new_activity_action">
        <a href="{{ url_for('add_activity') }}">Add Activity</a>
      </div>

      {% else %}
      <p class="text-muted mt-2">No activities yet.</p>
      {% endif %}
    </div>

    <nav class="prev-next-nav">
      <h2 class="cal-title">{{ month }} {{ year }}</h2>
      <a href="{{ url_for('track', year=prev_year, month=prev_month) }}"
        >← Prev</a
      >
      <span class="divider">|</span>
      <a href="{{ url_for('track', year=next_year, month=next_month) }}"
        >Next →</a
      >
    </nav>

    <nav class="month-nav months">
      {% for mname, mnum in month_numbers.items() %}
      <a
        href="{{ url_for('track', year=year, month=mnum) }}"
        class="{% if mnum == month_num %}active{% endif %}"
      >
        {{ mname }}
      </a>
      {% endfor %}
    </nav>
  </div>

  <div class="calendar-wrapper">
    <ul class="calendar-grid weekday-row" aria-hidden="true">
      <li>M</li>
      <li>T</li>
      <li>W</li>
      <li>T</li>
      <li>F</li>
      <li>S</li>
      <li>S</li>
    </ul>

    <ul class="calendar-grid">
      {# Leading blanks #} {% for _ in range(leading_blanks) %}
      <li class="calendar-box empty" aria-hidden="true"></li>
      {% endfor %} {# Real days #} {% for day in range(1, num_days + 1) %} {%
      set date_str = "{:04d}-{:02d}-{:02d}".format(year, month_num, day) %}
      <li class="calendar-box" data-date="{{ date_str }}">
        <span class="day-number">{{ day }}</span>
        <div class="day-icons">
          {% for it in icons_by_date.get(date_str, []) %}
          <img
            src="https://api.iconify.design/{{ (it.icon_ref or it.icon)|replace(':','/') }}.svg"
            class="day-icon"
            data-activity-id="{{ it.activity_id }}"
            loading="lazy"
            alt=""
          />
          {% endfor %}
        </div>
      </li>
      {% endfor %} {# Trailing blanks #} {% for _ in range(trailing_blanks) %}
      <li class="calendar-box empty" aria-hidden="true"></li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  window.ICON_BASE = "{{ url_for('static', filename='icons/') }}";
</script>
<script src="{{ url_for('static', filename='script.js') }}" defer></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // adjust selector to match your flash markup
    document.querySelectorAll('.alert, .flash').forEach((el) => {
      setTimeout(() => {
        el.style.transition = 'opacity 300ms';
        el.style.opacity = '0';
        setTimeout(() => el.remove(), 320);
      }, 2000);
    });
  });
</script>
{% endblock %}
